!function(){"use strict";const e=async e=>{const t=(()=>{let e=window.Shopify?.shop;return e})();if(t){const n=await(async(e,t)=>{try{const t=await fetch(`/apps/chatbot-api/supabase?shopId=${encodeURIComponent(e)}`,{method:"GET",credentials:"same-origin",headers:{Accept:"application/json"}});if(!t.ok)throw new Error(`Server responded with status: ${t.status}`);return(await t.json()).color}catch(e){return console.error("Error fetching the color preference!",e),t}})(t,e);n&&(e=>{document.querySelectorAll(".chatbot-toggle-button, .chatbot-header, .send-button").forEach((t=>{t.style.backgroundColor=e})),document.querySelectorAll(".chatbot-window").forEach((t=>{t.style.borderColor=e})),document.querySelectorAll(".typing-indicator span").forEach((t=>{t.style.backgroundColor=e}))})(n)}};function t(e,t,o){const r=new Headers({"Content-Type":"application/json",Accept:"application/json"});fetch("/apps/chatbot-api/deepseek",{method:"POST",headers:r,body:JSON.stringify({messages:[{role:"user",content:e}]})}).then((e=>e.ok?e.json():e.json().then((t=>{throw new Error(`Server error: ${e.status} - ${JSON.stringify(t)}`)})))).then((e=>{t&&t.remove(),e&&e.answer?n(e.answer,"bot",e.products||[],o):n("Sorry, I couldn't process your request.","bot",[],o)})).catch((e=>{t&&t.remove(),n("Sorry, there was an error processing your request. Please try again later.","bot",[],o),console.error("Error:",e)}))}function n(e,t,n=[],o){const r=document.querySelector(".message-list"),c=document.createElement("div");c.className="message-wrapper";const s=document.createElement("div");if(s.className=`message ${t}-message`,s.textContent=e,s.style.backgroundColor="#40444b",s.style.borderColor="#40444b",c.appendChild(s),n&&n.length>0){const e=function(e,t){const n=document.createElement("div");return n.className="product-slider",e.slice(0,4).forEach((e=>{const o=document.createElement("div");o.className="product-card";const r=document.createElement("img");r.src=e.image,r.alt=e.title,r.className="product-image";const c=document.createElement("div");c.className="product-title",c.textContent=e.title;const s=document.createElement("div");s.className="product-price",s.textContent=e.price;const a=document.createElement("a");a.href=e.url,a.target="_blank",a.rel="noopener noreferrer",a.className="view-product-button",a.textContent="View Product",a.style.backgroundColor=t,o.appendChild(r),o.appendChild(c),o.appendChild(s),o.appendChild(a),n.appendChild(o)})),n}(n,o);c.appendChild(e)}r.appendChild(s),function(){const e=document.querySelector(".chat-window");e.scrollTop=e.scrollHeight}()}document.addEventListener("DOMContentLoaded",(function(){const n=document.getElementById("shopify-chatbot");if(!n)return;const o="#008080";n.style.setProperty("--primary-color",o),n.style.setProperty("--text-color","#f8f8f8");const r=function(e){const t=document.createElement("button");return t.className="chatbot-toggle-button",t.innerHTML="ðŸ’¬",t.style.backgroundColor=e,t}(o);n.appendChild(r);const c=function(e,t){const n=document.createElement("div");n.className="chatbot-window",n.style.borderColor=e;const o=document.createElement("div");o.className="chatbot-header",o.style.backgroundColor=e,o.innerHTML=`\n      <h3 class="chatbot-header-title">${t}</h3>\n      <button class="chatbot-close-button">âœ•</button>\n    `,n.appendChild(o);const r=document.createElement("div");r.className="chat-window";const c=document.createElement("div");c.className="message-list",r.appendChild(c),n.appendChild(r);const s=document.createElement("div");return s.className="input-component",s.innerHTML=`\n      <input type="text" class="input-box" placeholder="Type your message...">\n      <button class="send-button" disabled style="background-color: ${e};">\n        Send\n      </button>\n    `,n.appendChild(s),n}(o,"Store Assistant");n.appendChild(c),r.addEventListener("click",(()=>{c.classList.toggle("open"),c.classList.contains("open")?r.innerHTML="Ã—":r.innerHTML="ðŸ’¬",c.classList.contains("open")&&document.querySelector(".input-box").focus()})),c.querySelector(".chatbot-close-button").addEventListener("click",(()=>{c.classList.remove("open"),document.querySelector(".chatbot-toggle-button").innerHTML="ðŸ’¬"})),function(){const e=document.querySelector(".input-box"),n=document.querySelector(".send-button"),o=document.querySelector(".message-list");function r(){const r=e.value.trim();if(""===r)return;c(r,"user"),e.value="",n.disabled=!0;const a=document.createElement("div");a.className="typing-indicator",a.innerHTML="<span></span><span></span><span></span>",a.style.backgroundColor="#40444b",a.style.borderColor="#40444b",o.appendChild(a),s(),t(r,a)}function c(e,t){const n=document.createElement("div");n.className=`message ${t}-message`,n.textContent=e,o.appendChild(n),s()}function s(){const e=document.querySelector(".chat-window");e.scrollTop=e.scrollHeight}e.addEventListener("input",(()=>{n.disabled=""===e.value.trim()})),n.addEventListener("click",(()=>r())),e.addEventListener("keypress",(t=>{"Enter"===t.key&&""!==e.value.trim()&&(t.preventDefault(),r())})),setTimeout((()=>{c("Hi there! How can I help you today?","bot")}),500)}(),e(o)}))}();
